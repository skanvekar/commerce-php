{"version":3,"file":"component---src-pages-development-framework-inventory-management-source-selection-algorithms-md-69b12eea48f83d400877.js","mappings":"uMAUsBA,E,wEAFTC,EAAe,CAAC,EAOvBC,GALgBF,EAKY,cALJ,SAA6BG,GAEzD,OADAC,QAAQC,KAAK,aAAeL,EAAO,4EAC5B,eAASG,EACjB,GAGKG,EAAc,CAClBL,aAAAA,GAEIM,EAAYC,EAAAA,EACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGP,GACF,YACD,OAAO,SAACI,GAAD,UAAeD,EAAiBH,EAAhC,CAAuCO,WAAYA,EAAYC,QAAQ,eAG5E,eACE,GAAM,+BADR,gCAGA,0BAAW,mBAAQC,WAAW,KAAnB,oCAAX,iKACA,oBACE,eAAIA,WAAW,MAAf,iGACA,eAAIA,WAAW,MAAf,wFACA,eAAIA,WAAW,MAAf,4DACA,eAAIA,WAAW,MAAf,gHAEF,SAACV,EAAD,CAAaW,QAAQ,OAAOC,MAAM,OAAOH,QAAQ,iBACjD,0BAAW,cAAGC,WAAW,IACrB,KAAQ,uGADD,sCAAX,YAE2D,eAAIA,WAAW,KAAf,oBAF3D,MAGA,eACE,GAAM,kBADR,mBAGA,iIAAkH,uBAAYA,WAAW,KAAvB,mCAAlH,gBAA6M,uBAAYA,WAAW,KAAvB,6BAA7M,+PACA,qQAAsP,uBAAYA,WAAW,KAAvB,6BAAtP,gBAA2U,uBAAYA,WAAW,KAAvB,2BAA3U,qEACA,qZAAsY,uBAAYA,WAAW,KAAvB,SAAtY,yEAAggB,uBAAYA,WAAW,KAAvB,SAAhgB,aACA,iJAAkI,uBAAYA,WAAW,KAAvB,SAAlI,QAA2L,uBAAYA,WAAW,KAAvB,SAA3L,iKACA,mEACA,oBACE,eAAIA,WAAW,OAAK,cAAGA,WAAW,KAC9B,KAAQ,uIADQ,6BAApB,yDAGA,eAAIA,WAAW,OAAK,cAAGA,WAAW,KAC9B,KAAQ,kIADQ,wBAApB,0DAGA,eAAIA,WAAW,OAAK,cAAGA,WAAW,KAC9B,KAAQ,wIADQ,mCAApB,qEAEiH,uBAAYA,WAAW,MAAvB,sBACjH,eAAIA,WAAW,OAAK,cAAGA,WAAW,KAC9B,KAAQ,iJADQ,4CAApB,wEAGA,eAAIA,WAAW,OAAK,cAAGA,WAAW,KAC9B,KAAQ,+IADQ,qCAApB,6BAGA,eAAIA,WAAW,OAAK,cAAGA,WAAW,KAC9B,KAAQ,mIADQ,4BAApB,8CAEmF,uBAAYA,WAAW,MAAvB,sBACnF,eAAIA,WAAW,OAAK,cAAGA,WAAW,KAC9B,KAAQ,0IADQ,wBAApB,kLAEmN,uBAAYA,WAAW,MAAvB,qGAFnN,OAIF,eACE,GAAM,8BADR,+BAGA,uHACA,oBACE,eAAIA,WAAW,MAAf,cAAkC,uBAAYA,WAAW,MAAvB,8BAClC,eAAIA,WAAW,MAAf,iEAAqF,uBAAYA,WAAW,MAAvB,6BACrF,eAAIA,WAAW,MAAf,+BAAmD,uBAAYA,WAAW,MAAvB,UAAnD,WAEF,eACE,GAAM,uCADR,eAEkB,uBAAYA,WAAW,MAAvB,8BAClB,8CAA+B,uBAAYA,WAAW,KAAvB,4BAA/B,4BACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,+BADZ,+dAmBL,qEAAsD,uBAAYA,WAAW,KAAvB,gCAAtD,YACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,+BADZ,yYAmBL,eACE,GAAM,0DADR,aAEgB,uBAAYA,WAAW,MAAvB,oBAFhB,oCAGA,2CAA4B,cAAGA,WAAW,IACtC,KAAQ,kIACP,uBAAYA,WAAW,KAAvB,qCAFL,kGAGA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,+BADZ,0xCAqCL,0GAA2F,uBAAYA,WAAW,KAAvB,6BAA3F,gBAAgL,uBAAYA,WAAW,KAAvB,SAAhL,kCACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,+BADZ,kTAcL,eACE,GAAM,mBADR,cAEiB,uBAAYA,WAAW,MAAvB,YACjB,8CAA+B,uBAAYA,WAAW,KAAvB,cAA/B,oCAAyH,uBAAYA,WAAW,KAAvB,mCAAzH,SAA6M,uBAAYA,WAAW,KAAvB,mCAA7M,MACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBADZ,ugCAuBR,CAEDH,EAAWM,gBAAiB,C","sources":["webpack://commerce-php/./src/pages/development/framework/inventory-management/source-selection-algorithms.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/commerce-php/commerce-php/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst InlineAlert = makeShortcode(\"InlineAlert\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"source-selection-algorithms\"\n    }}>{`Source selection algorithms`}</h1>\n    <p>{`The `}<strong parentName=\"p\">{`Source Selection Algorithm (SSA)`}</strong>{` recommends how to fulfill partial and full shipments. The merchant decides which business needs take precedence when deciding which shipping method to use:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Should the products be delivered from the sources designated as having the highest priority?`}</li>\n      <li parentName=\"ul\">{`Should the total shipment cost be the primary factor in choosing a shipment method?`}</li>\n      <li parentName=\"ul\">{`Should the shipments originate from the closest source?`}</li>\n      <li parentName=\"ul\">{`Should the fastest shipping method with the shortest delivery time be used, even if it's not the cheapest?`}</li>\n    </ul>\n    <InlineAlert variant=\"info\" slots=\"text\" mdxType=\"InlineAlert\" />\n    <p>{`See `}<a parentName=\"p\" {...{\n        \"href\": \"https://experienceleague.adobe.com/docs/commerce-admin/inventory/basics/selection-reservations.html\"\n      }}>{`Source Algorithms and Reservations`}</a>{` in the `}<em parentName=\"p\">{`Admin User Guide`}</em>{`.`}</p>\n    <h2 {...{\n      \"id\": \"ssa-interfaces\"\n    }}>{`SSA interfaces`}</h2>\n    <p>{`The source priority algorithm recommends delivering products from sources having the highest priority. The `}<inlineCode parentName=\"p\">{`SourceSelectionServiceInterface`}</inlineCode>{` accepts an `}<inlineCode parentName=\"p\">{`InventoryRequestInterface`}</inlineCode>{` object, which in turn contains the stock ID and a list of items to be shipped. Each item contains only the SKU and quantity. Other potentially relevant data, such as shipping address, is not included, because the priority algorithm does not need it.`}</p>\n    <p>{`Additional input data might be needed for more sophisticated algorithms, such as the Distance Priority algorithm. In this case, the algorithm needs the shipping address and all data entered for the source (GPS or full address). That's why `}<inlineCode parentName=\"p\">{`InventoryRequestInterface`}</inlineCode>{` implements `}<inlineCode parentName=\"p\">{`ExtensibleDataInterface`}</inlineCode>{` interfaces, which can be extended with custom input parameters.`}</p>\n    <p>{`Currently, Inventory Management deducts stock from the appropriate source after the merchant creates a shipment for an order. However, that's not flexible enough--a developer might want to introduce customizations and launch the SSA when the customer proceeds to checkout. Running the SSA at this point could provide the customer more accurate shipping costs. Note in this case, the `}<inlineCode parentName=\"p\">{`Order`}</inlineCode>{` object has not created yet, and the system must instead rely on the `}<inlineCode parentName=\"p\">{`Quote`}</inlineCode>{` object.`}</p>\n    <p>{`Taking into account that there are at least two valid business cases when to launch the SSA, and the data source can be an `}<inlineCode parentName=\"p\">{`Order`}</inlineCode>{` or `}<inlineCode parentName=\"p\">{`Quote`}</inlineCode>{` object, Inventory Management introduces a new layer of abstraction. The algorithm must use an abstract data container instead of a specific Magento entity.`}</p>\n    <p>{`Use these interfaces to create your own SSA:`}</p>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/magento/inventory/blob/1.1.3/app/code/Magento/InventorySourceSelectionApi/Api/Data/InventoryRequestInterface.php\"\n        }}>{`InventoryRequestInterface`}</a>{` requests products for a given quantity and stock ID`}</li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/magento/inventory/blob/1.1.3/app/code/Magento/InventorySourceSelectionApi/Api/Data/ItemRequestInterface.php\"\n        }}>{`ItemRequestInterface`}</a>{` represents the requested quantity for a specific SKU`}</li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/magento/inventory/blob/1.1.3/app/code/Magento/InventorySourceSelectionApi/Api/SourceSelectionServiceInterface.php\"\n        }}>{`SourceSelectionServiceInterface`}</a>{` returns the source selection algorithm result for the specified `}<inlineCode parentName=\"li\">{`inventoryRequest`}</inlineCode></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/magento/inventory/blob/1.1.3/app/code/Magento/InventorySourceSelectionApi/Api/GetSourceSelectionAlgorithmListInterface.php\"\n        }}>{`GetSourceSelectionAlgorithmListInterface`}</a>{` returns the list of data interfaces that represent registered SSAs`}</li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/magento/inventory/blob/1.1.3/app/code/Magento/InventorySourceSelectionApi/Api/Data/SourceSelectionAlgorithmInterface.php\"\n        }}>{`SourceSelectionAlgorithmInterface`}</a>{` represents a single SSA`}</li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/magento/inventory/blob/1.1.3/app/code/Magento/InventorySourceSelectionApi/Model/SourceSelectionInterface.php\"\n        }}>{`SourceSelectionInterface`}</a>{` returns the SSA result for the specified `}<inlineCode parentName=\"li\">{`inventoryRequest`}</inlineCode></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/magento/inventory/blob/1.1.3/app/code/Magento/InventoryDistanceBasedSourceSelectionApi/Api/GetDistanceInterface.php\"\n        }}>{`GetDistanceInterface`}</a>{`  - returns the distance between the source and the shipping address in kilometers without specifying the units. To change this behavior, provide your own implementation for `}<inlineCode parentName=\"li\">{`\\\\Magento\\\\InventoryDistanceBasedSourceSelection\\\\Model\\\\DistanceProvider\\\\GoogleMap\\\\GetDistance`}</inlineCode>{`.`}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"develop-a-custom-algorithm\"\n    }}>{`Develop a custom algorithm`}</h2>\n    <p>{`As you develop your custom Source Selection Algorithm, keep these design considerations in mind:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Implement `}<inlineCode parentName=\"li\">{`SourceSelectionInterface`}</inlineCode></li>\n      <li parentName=\"ul\">{`If your module provides an SSA on quotes, introduce your own `}<inlineCode parentName=\"li\">{`InventoryRequestFactory`}</inlineCode></li>\n      <li parentName=\"ul\">{`Register your SSA within a `}<inlineCode parentName=\"li\">{`di.xml`}</inlineCode>{` file`}</li>\n    </ul>\n    <h3 {...{\n      \"id\": \"implement--sourceselectioninterface\"\n    }}>{`Implement  `}<inlineCode parentName=\"h3\">{`SourceSelectionInterface`}</inlineCode></h3>\n    <p>{`Your SSA must implement `}<inlineCode parentName=\"p\">{`SourceSelectionInterface`}</inlineCode>{`, which is shown below:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php?start_inline=1\"\n      }}>{`/**\n * Returns source selection algorithm result for given Inventory Request\n * Current interface should be implemented in order to add own Source Selection Method\n *\n * @api\n */\ninterface SourceSelectionInterface\n{\n    /**\n     * @param InventoryRequestInterface $inventoryRequest\n     * @return SourceSelectionResultInterface\n     */\n    public function execute(\n       InventoryRequestInterface $inventoryRequest\n    ): SourceSelectionResultInterface;\n}\n`}</code></pre>\n    <p>{`For example, the following example defines the `}<inlineCode parentName=\"p\">{`MinimalDeliveryCostAlgorithm`}</inlineCode>{` class:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php?start_inline=1\"\n      }}>{`namespace Some\\\\Vendor\\\\Namespace\\\\SourceSelection;\n\n/**\n * Minimal Delivery Cost for Merchant algorithm\n *\n * @api\n */\nclass MinimalDeliveryCostAlgorithm implements SourceSelectionInterface\n{\n    public function execute(\n       InventoryRequestInterface $inventoryRequest\n    ): SourceSelectionResultInterface;\n    {\n        // TODO: Implement execute() method.\n    }\n}\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"create-a-inventoryrequest-factory-for-quotes--optional\"\n    }}>{`Create a `}<inlineCode parentName=\"h3\">{`InventoryRequest`}</inlineCode>{` factory for quotes  (optional)`}</h3>\n    <p>{`Magento provides the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/magento/inventory/blob/1.1.3/app/code/Magento/InventoryShipping/Model/InventoryRequestFromOrderFactory.php\"\n      }}><inlineCode parentName=\"a\">{`InventoryRequestFromOrderFactory`}</inlineCode></a>{`, which determines the sources to use to fulfill the order at the time a shipment is created.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php?start_inline=1\"\n      }}>{`class InventoryRequestFromOrderFactory\n{\n      /**\n     * @param OrderInterface $order\n     * @return InventoryRequestInterface\n     */\n    public function create(OrderInterface $order) : InventoryRequestInterface\n    {\n        $requestItems = [];\n        $websiteId = $order->getStore()->getWebsiteId();\n        $stockId = (int)$this->stockByWebsiteIdResolver->execute((int)$websiteId)->getStockId();\n        /** @var OrderItemInterface|OrderItem $orderItem */\n        foreach ($order->getItems() as $orderItem) {\n            $itemSku = $this->getSkuFromOrderItem->execute($orderItem);\n            $qtyToDeliver = $orderItem->getQtyToShip();\n            //check if order item is not delivered yet\n            if ($orderItem->isDeleted()\n                || $orderItem->getParentItemId()\n                || $this->isZero((float)$qtyToDeliver)\n                || $orderItem->getIsVirtual()\n            ) {\n                continue;\n            }\n            $requestItems[] = $this->itemRequestFactory->create([\n                    'sku' => $itemSku,\n                    'qty' => $qtyToDeliver\n            ]);\n        }\n        return $this->inventoryRequestFactory->create([\n            'stockId' => $stockId,\n            'items' => $requestItems\n        ]);\n    }\n}\n`}</code></pre>\n    <p>{`To add an SSA at the time of checkout, introduce your own factory that produces an  `}<inlineCode parentName=\"p\">{`InventoryRequestInterface`}</inlineCode>{` based on a `}<inlineCode parentName=\"p\">{`Quote`}</inlineCode>{` object, outlined as follows:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php?start_inline=1\"\n      }}>{`class InventoryRequestFactory\n{\n    /**\n     * @param \\\\Magento\\\\Quote\\\\Api\\\\Data\\\\CartInterface $quote\n     * @return InventoryRequestInterface\n     */\n    public function create(\\\\Magento\\\\Quote\\\\Api\\\\Data\\\\CartInterface $quote) : InventoryRequestInterface\n    {\n        // TODO\n    }\n}\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"configure-dixml\"\n    }}>{`Configure `}<inlineCode parentName=\"h3\">{`di.xml`}</inlineCode></h3>\n    <p>{`Configure your module's `}<inlineCode parentName=\"p\">{`etc/di.xml`}</inlineCode>{` file to register your SSA with `}<inlineCode parentName=\"p\">{`SourceSelectionServiceInterface`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`GetSourceSelectionAlgorithmList`}</inlineCode>{`.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<type name=\"Magento\\\\InventorySourceSelectionApi\\\\Model\\\\SourceSelectionService\">\n    <arguments>\n        <argument name=\"sourceSelectionMethods\" xsi:type=\"array\">\n            <item name=\"minimalDeliveryCost\" xsi:type=\"string\">Some\\\\Vendor\\\\Namespace\\\\SourceSelection\\\\MinimalDeliveryCostAlgorithm</item>\n        </argument>\n    </arguments>\n</type>\n<type name=\"Magento\\\\InventorySourceSelectionApi\\\\Model\\\\GetSourceSelectionAlgorithmList\">\n    <arguments>\n        <argument name=\"availableAlgorithms\" xsi:type=\"array\">\n            <item name=\"minimalDeliveryCost\" xsi:type=\"array\">\n                <item xsi:type=\"string\" name=\"code\">minimalDeliveryCost</item>\n                <item xsi:type=\"string\" name=\"title\" translatable=\"true\">Minimal Delivery Cost</item>\n                <item xsi:type=\"string\" name=\"description\" translatable=\"true\">Algorithm that calculates the shipping option with the lowest shipping cost to the merchant.</item>\n            </item>\n        </argument>\n    </arguments>\n</type>\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["name","_frontmatter","InlineAlert","props","console","warn","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","variant","slots","isMDXComponent"],"sourceRoot":""}